\chapter{Introduction}
\label{ch:Introduction}

Monitoring and assessment of human body motion, in particular the analysis of gait, has become an integral part of medical diagnosis, therapy techniques, and rehabilitation \cite{tao_gait_2012}. \emph{Gait analysis} involves the measurement and assessment of quantitative parameters that characterise human locomotion. First research in this field was conducted in the late 19th century \cite{tao_gait_2012}. The quantitative data enable physicians to diagnose a variety of medical conditions, validate treatment success, set goals in rehabilitation and regularly alter them when necessary. However, standard gait analysis based on multi-camera motion capture systems and force measuring platforms require specialised gait laboratories, expensive equipment, and lengthy setup times. Moreover, the assessments of gait based on measurements performed in clinical settings might not be truly representative \cite{bonato_advances_2005}.

Unobtrusive wearable sensors mitigate the aforementioned limitations. The progressive miniaturisation of inertial and magnetic field sensors has made them more acceptable to patients and has consequently lead to an increasingly pervasive adoption for medical applications \cite{wee_soon_ambulatory_2008}. Low cost sensors have been successfully employed in clinical and home environments to constantly monitor the movements of patients \cite{godfrey_direct_2008}. Additionally, wearable inertial and magnetic sensors are used to capture gait kinematics, among others. \emph{Kinematics} is a branch of classical mechanics, which is concerned with the motion of objects without reference to the forces causing the motion. The position, i.\,e. the orientation, the velocity, and the acceleration of a body are of particular interest in kinematics. All three can be estimated from inertial data.

The orientation of the legs is essential in gait analysis. For the application in health care accurate orientation estimates are crucial. A high degree of precision based on data from miniaturised sensors necessitates adequate signal processing, in order to mitigate the influence of disruptive factors, such as bias instability and noise, among others. The signal processing of inertial and magnetic data encompasses calibration, adaptive filtering, and sensor fusion. The latter two were carried out in an extended Kalman filter in the course of this thesis.

\section{Motivation}

Gait analysis provides a powerful means to derive diagnostic information about the functioning of the musculoskeletal, vestibular, and central and peripheral nervous system \cite{bennett_extended_2013}. Accurate orientation estimation of the extremities by means of wearable inertial and magnetic field sensors allows objective assessment of human gait without the aforementioned constraints of camera-based motion capture systems. A more reliable and more precise orientation estimation would enable an even more informative gait analysis. Therefore, a multitude of applications in the medical field would profit from a more accurate orientation estimation \cite{wong_clinical_2007}. The direct relation to health care and the resulting possibility to improve the quality of life of many patients was the motivation for this thesis.

\section{Goals}

A system for human body motion analysis based on wearable sensors had been developed earlier, in order to gather and process  movement data of patients. A detailed description of the so-called GaitWatch system is found in Section \ref{sec:initial_situation}. The goal of this thesis was implementing a new Kalman filter based orientation algorithm proposed by \citeauthor{bennett_motion_2014} in \cite{bennett_motion_2014}, in order to improve the estimation of the orientation angles of the human leg. After the adaptation of the proposed mathematical model of the leg and the extended Kalman filter to the existing system, the algorithm should be implemented using the numerical computing environment \textsc{Matlab}\textsuperscript{\textregistered}. Subsequently, the results should be validated against existing algorithms by comparing their respective root-mean-square error. Other than in \cite{bennett_motion_2014}, the filter algorithms should be applied to data of real patients for testing.

\section{Methodology}

This document presents my work within the overall project in a chronological order. Subsequent to the previous introductory overview of the topic and the definition of the project objectives, this chapter ends with a description of the state of the art. To accomplish the tasks defined in the previous section, I had to acquire knowledge regarding various subjects. Chapters \ref{ch:orientation_estimation} and \ref{ch:digital_filters} outline the necessary fundamentals of MARG sensors and orientation estimation, and digital filters, respectively. This enables comprehension of the overall project, even for readers that are not familiar with some of the subjects. Those readers are referred to Chapters \ref{ch:orientation_estimation} and \ref{ch:digital_filters} at this point, before reading the state of the art. The actual implementation of the Kalman filter, including a prior theoretical design is given in Chapter \ref{ch:Implementation}. This chapter also encompasses the experimental setup, the results and a discussion of the latter. Finally, Chapter \ref{ch:Conclusion and Future Work} covers conclusions and future work.

As additional means to communicate with my supervisor and in order to enable him to follow the progress of my work at any time we used Pivotal Tracker, a tool for agile project management, and GitHub, a repository hosting service based on the distributed version control system Git. This thesis was written in \LaTeX{}.
 
\section{State of the Art}\label{sec:state_of_the_art}

There are several research works in the literature dealing with orientation estimation by means of inertial sensors. Kalman filters have been used successfully to improve the estimation of orientation angles from inertial data. The state of the art at the commencement of the project is described below. Subsequently, applications of wearable inertial sensors in health care are presented.

\subsection{Kalman Filtering Applied to Orientation Estimation} \label{sec:state_of_the_art_kalman}

Considering the fact that inertial and magnetic field sensors are used to establish objective body motion parameters that affect medical diagnosis, therapy, and rehabilitation, the necessity of high levels of accuracy becomes obvious. In order to obtain precise orientation estimates from sensor data, it is essential to alleviate the effects of measurement noise and to combine the advantages of different  sensors through sensor fusion. Therefore, a wide variety of Kalman filter algorithms have been developed in the past few years. It is common practice to fuse accelerometer and gyroscope measurements to mitigate their respective drawbacks and thus obtain more accurate angle estimates.

\citeauthor{Luinge_orientation_acc_gyro_99} \cite{Luinge_orientation_acc_gyro_99} alleged that the gravitational component of the acceleration signal has a greater magnitude than the component caused by motion for many human movements. They estimated the tilt angle, which is defined as the angle between the sensor axes and the vertical. The separate estimates from an accelerometer and a gyroscope were fused with a Kalman filter. To test their method they moved the sensors around by hand for 30 seconds and then put them in a known position. The orientation obtained by integrating the angular rate served as an additional reference. They concluded that a fusion of accelerometer and gyroscope signals accounts for a considerable improvement of the orientation estimation. This approach lacks dynamical comparison, since it only compares the errors at specific static positions.

Due to human motion intensity usually being subject to change, \citeauthor{olivares_vicente_signal_2013} implemented a \emph{gated Kalman filter} in \cite{olivares_vicente_signal_2013}. They modelled linear acceleration during intense motion as noise and improved the performance of the Kalman filter by dynamically adjusting the variance of both the process and measurement noise, according to the motion intensity. For that purpose, they applied a \gls{LTSD} and set the variance between two predefined values. Then, the gated Kalman filter fused the information from the accelerometer and the gyroscope signals. With this method they improved the adapting capability of the filter and consequently the precision of the orientation estimation.

\citeauthor{bennett_motion_2014} demonstrated in \cite{bennett_motion_2014} that accelerometer angle estimates are inaccurate for typical motions of the leg. They affirmed the need to decouple the acceleration due to motion from the acceleration due to gravity, since the former cannot be neglected during fast motions. Therefore, they deployed a kinematic model of the leg to determine the acceleration that occurs due to motion and corrected the acceleration signal accordingly. An extended Kalman filter fused the corrected acceleration signal with measurements of a gyroscope. They tested the filter algorithm by moving a mechanical two link pendulum by hand. Their method improved upon the raw acceleration method during motion and at rest by an 83\% smaller root-mean-square error. Their proposed approach is the foundation of the filter algorithm implemented in Section \ref{sec:theoretical_design}.

\subsection{Wearable Sensors in Health Care}\label{sec:MARG_sensors_medical}

Inertial sensors can be found in smart phones, fitness trackers, and other wearable devices, among others. With increasing capability of body sensor networks and wearable computing, they have become prevalent in research environments for estimation and tracking of human body motion \cite{bennett_motion_2014}. They are used in activity monitoring \cite{veltink_detection_96, najafi_ambulatory_03, ermes_sports_08}, rehabilitation \cite{giggins_rehabilitation_13, lupinski_ligament_11}, sports training \cite{bonnet_squat_13, ermes_sports_08}, and localisation \cite{hoflinger_localization_13, Bennett_distance_13}. Also, emergency falls of elderly people were detected by means of inertial sensors \cite{bourke_threshold-based_2008, bourke_assessment-waist_2010, bourke_fall_detection_2008}.

Many neurodegenerative diseases, such as Parkinson's disease, impair stable stance and gait, and reduce the patient's mobility. Thus, they diminish the quality of life significantly. \emph{Parkinson's disease} is a movement disorder that is characterised by marked slow movements, tremors, and unstable posture. Especially in advanced stages of the disease many patients exhibit an episodic, brief inability to step, which delays gait initiation or interrupts ongoing gait. In fact, one of the most reliable diagnostic criterion of the disease is gait \cite{tao_gait_2012}. Hence, wearable motion sensors have been used successfully to objectively classify the severity of the disease \cite{mancini_anticipatory_2009, palmerini_feature_2011, klerk_long-term_2009}.

Stroke patients, who regained their walking ability, need to undergo rehabilitation to recover their independent mobility. Ambulatory gait analysis provides a means to assess the function of the lower extremities of hemiparetic post-stroke patients and follow the progress of rehabilitation \cite{tao_gait_2012, saremi_reliability_2006}. In addition, the presence of neurologic gait abnormalities is used as a significant predictor of the risk of developing dementia \cite{verghese_dementia_2002}.

