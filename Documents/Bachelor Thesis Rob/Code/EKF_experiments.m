clear all; close all; clc;

load('data.mat');

[pitch_EKF_right_thigh, pitch_EKF_right_shank] = ...
            fusion_EKF(g_Y_right_thigh_1_C', ...
                       g_Y_right_shank_1_C', ...
                       a_X_right_thigh_1_C', ...
                       a_Z_right_thigh_1_C', ...
                       a_X_right_shank_1_C', ...
                       a_Z_right_shank_1_C', ...
                       f, 0.3, 0.3);
                   
n = 20;

figure1 = figure(1);
hold on
plot(time(1:n), pitch_acc_right_shank(1:n), ...
     time(1:n), pitch_gyro_right_shank(1:n), ...
     time(1:n), pitch_KF_right_shank(1:n), ...
     time(1:n), pitch_GKF_right_shank(1:n), ...
     time(1:n), pitch_EKF_right_shank(1:n));
xlabel('Time $t$ in s', ...
       'interpreter','latex');
ylabel('Pitch angle $\theta_2$ in $^{\circ}$', ...
       'interpreter','latex');
legend('Accelerometer-based', ...
       'Integration of angular rate', ...
       'Kalman filter', 'Gated Kalman filter', ...
       'Extended Kalman filter');
   
matlab2tikz('../images/experiment_1.tikz', 'height', ...
            '\figureheight', 'width', '\figurewidth');

n = 200; 
       
figure2 = figure(2);
hold on
plot(time(1:n), pitch_acc_right_shank(1:n), ...
     time(1:n), pitch_gyro_right_shank(1:n), ...
     time(1:n), pitch_KF_right_shank(1:n), ...
     time(1:n), pitch_GKF_right_shank(1:n), ...
     time(1:n), pitch_EKF_right_shank(1:n));
xlabel('Time $t$ in s', ...
       'interpreter','latex');
ylabel('Pitch angle $\theta_2$ in $^{\circ}$', ...
       'interpreter','latex');
legend('Accelerometer-based', ...
       'Integration of angular rate', ...
       'Kalman filter', 'Gated Kalman filter', ...
       'Extended Kalman filter');
   
matlab2tikz('../images/experiment_2.tikz', 'height', ...
            '\figureheight', 'width', '\figurewidth');
        
n = 1000; 
       
figure3 = figure(3);
hold on
plot(time(1:n), pitch_acc_right_shank(1:n), ...
     time(1:n), pitch_gyro_right_shank(1:n), ...
     time(1:n), pitch_KF_right_shank(1:n), ...
     time(1:n), pitch_GKF_right_shank(1:n), ...
     time(1:n), pitch_EKF_right_shank(1:n));
xlabel('Time $t$ in s', ...
       'interpreter','latex');
ylabel('Pitch angle $\theta_2$ in $^{\circ}$', ...
       'interpreter','latex');
legend('Accelerometer-based', ...
       'Integration of angular rate', ...
       'Kalman filter', 'Gated Kalman filter', ...
       'Extended Kalman filter');
   
matlab2tikz('../images/experiment_3.tikz', 'height', ...
            '\figureheight', 'width', '\figurewidth');
        
n = length(pitch_acc_right_shank); 
       
figure4 = figure(4);
hold on
plot(time(1:n), pitch_acc_right_shank(1:n), ...
     time(1:n), pitch_gyro_right_shank(1:n), ...
     time(1:n), pitch_KF_right_shank(1:n), ...
     time(1:n), pitch_GKF_right_shank(1:n), ...
     time(1:n), pitch_EKF_right_shank(1:n));
xlabel('Time $t$ in s', ...
       'interpreter','latex');
ylabel('Pitch angle $\theta_2$ in $^{\circ}$', ...
       'interpreter','latex');
legend('Accelerometer-based', ...
       'Integration of angular rate', ...
       'Kalman filter', 'Gated Kalman filter', ...
       'Extended Kalman filter');
   
matlab2tikz('../images/experiment_4.tikz', 'height', ...
            '\figureheight', 'width', '\figurewidth');
        
        